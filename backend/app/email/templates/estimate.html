{% extends "base.html" %}
{% block content %}
<h2 style="margin-top:0;">Estimate {{ estimate.estimate_number }}</h2>

{% if custom_message %}
<p>{{ custom_message }}</p>
<hr style="border:none;border-top:1px solid #e2e8f0;margin:20px 0;">
{% endif %}

<div style="margin-bottom:20px;">
  <div class="detail-row"><span class="detail-label">Estimate Number</span><span class="detail-value">{{ estimate.estimate_number }}</span></div>
  <div class="detail-row"><span class="detail-label">Issue Date</span><span class="detail-value">{{ estimate.issue_date }}</span></div>
  <div class="detail-row"><span class="detail-label">Valid Until</span><span class="detail-value">{{ estimate.expiry_date }}</span></div>
  <div class="detail-row"><span class="detail-label">Status</span><span class="detail-value">{{ estimate.status.value | upper }}</span></div>
</div>

{% if estimate.line_items %}
<table class="line-items">
  <thead>
    <tr>
      <th>Description</th>
      <th class="amount">Qty</th>
      <th class="amount">Unit Price</th>
      <th class="amount">Total</th>
    </tr>
  </thead>
  <tbody>
    {% for item in estimate.line_items %}
    <tr>
      <td>{{ item.description }}</td>
      <td class="amount">{{ item.quantity }}</td>
      <td class="amount">${{ "%.2f" | format(item.unit_price) }}</td>
      <td class="amount">${{ "%.2f" | format(item.total) }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}

<div style="text-align:right;margin-top:16px;">
  {% if estimate.subtotal is defined %}
  <div class="detail-row" style="justify-content:flex-end;gap:24px;">
    <span class="detail-label">Subtotal</span>
    <span class="detail-value">${{ "%.2f" | format(estimate.subtotal) }}</span>
  </div>
  {% endif %}
  {% if estimate.tax_amount %}
  <div class="detail-row" style="justify-content:flex-end;gap:24px;">
    <span class="detail-label">Tax</span>
    <span class="detail-value">${{ "%.2f" | format(estimate.tax_amount) }}</span>
  </div>
  {% endif %}
  {% if estimate.discount_amount %}
  <div class="detail-row" style="justify-content:flex-end;gap:24px;">
    <span class="detail-label">Discount</span>
    <span class="detail-value">-${{ "%.2f" | format(estimate.discount_amount) }}</span>
  </div>
  {% endif %}
  <div class="detail-row total-row" style="justify-content:flex-end;gap:24px;border-top:2px solid #1e293b;padding-top:8px;margin-top:8px;">
    <span>Total</span>
    <span>${{ "%.2f" | format(estimate.total) }} {{ estimate.currency }}</span>
  </div>
</div>

{% if view_url %}
<div style="text-align:center;margin-top:24px;">
  <a href="{{ view_url }}" class="btn">View Estimate</a>
</div>
{% endif %}

{% if estimate.notes %}
<div style="margin-top:24px;padding:16px;background:#f8fafc;border-radius:6px;font-size:14px;">
  <strong>Notes:</strong><br>{{ estimate.notes }}
</div>
{% endif %}

<p style="margin-top:24px;font-size:13px;color:#94a3b8;">
  Please find the estimate PDF attached to this email.
</p>
{% endblock %}
